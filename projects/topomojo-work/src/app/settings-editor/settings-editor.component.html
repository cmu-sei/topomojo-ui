<!-- Copyright 2021 Carnegie Mellon University. -->
<!-- Released under a 3 Clause BSD-style license. See LICENSE.md in the project root. -->

<alert type="warning" [dismissible]="true" dismissOnTimeout="10000">
  Inactive workspaces may be deleted by the janitor.<br/>
  <small>Inactive: "unpublished and idle" or "published and unused"</small>
</alert>

<div class="workspace-stats border rounded p-2 mb-3">
  <div class="d-flex flex-wrap align-items-center">
    <span class="mr-3">
      <span class="text-muted">Launch Count:</span>
      <strong class="ml-1">{{ workspace.stats.launchCount }}</strong>
    </span>

    <span>
      <span class="text-muted">Last Activity:</span>
      <strong class="ml-1">{{ workspace.stats.lastActivity }}</strong>
    </span>
  </div>
</div>

<div>
  <div class="font-weight-bold">Workspace Settings</div>
  <div class="text-muted">
    Use this tab to manage the workspace metadata: how it’s labeled, described, who it’s attributed to, who can
    launch it, and how long it’s expected to take.
  </div>
</div>

<form [formGroup]="form">

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="name-input">
      Title
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="The title of your workspace; remember that the title should be unique."
        aria-label="The title of your workspace; remember that the title should be unique."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>
    <input id="name-input" type="text" class="form-control" formControlName="name">
    <small>
      The name shown when browsing workspaces. Keep it unique and descriptive (e.g., “Web Exploits Lab 1”).
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="description-input">
      Description
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="A brief description of your workspace to display when browsing titles. The Description is viewable to everyone, and when used with Gameboard, visible there too."
        aria-label="A brief description of your workspace to display when browsing titles. The Description is viewable to everyone, and when used with Gameboard, visible there too."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>
    <textarea id="description-input" type="text" rows="3" class="form-control" formControlName="description"></textarea>
    <small>
      What this lab is about. This text appears in workspace browsing and may be visible broadly.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="tags-input">
      Tags
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="Internal metadata to add data about the lab (e.g., for a competition: cyber-cup c01). You can search by tags later."
        aria-label="Internal metadata to add data about the lab (e.g., for a competition: cyber-cup c01). You can search by tags later."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>
    <input id="tags-input" type="text" class="form-control" formControlName="tags">
    <small>
      Internal labels to help organize and search (e.g., “competition”, “web”, “c01”). Space-delimited.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="author-input">
      Authorship
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="Your name and the names of others who may have assisted you."
        aria-label="Your name and the names of others who may have assisted you."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>
    <input id="author-input" type="text" class="form-control" formControlName="author">
    <small>
      Credit the lab creators and contributors (shown as the workspace author text).
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="audience-input">
      Audience
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="A space-delimited list of administrator-defined groups that can launch a gamespace from this workspace. Users can launch only if their scope matches one of these audiences. 'everyone' is the global audience."
        aria-label="A space-delimited list of administrator-defined groups that can launch a gamespace from this workspace. Users can launch only if their scope matches one of these audiences. 'everyone' is the global audience."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>
    <input id="audience-input" type="text" class="form-control" formControlName="audience">
    <small>
      Who can launch/play this as a gamespace. Enter one or more groups (space-delimited). Use
      '<code>everyone</code>' to allow all users.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="durationMinutes-input">
      Duration
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="Recommended length of time (in minutes) it takes to play through a gamespace launched from this workspace."
        aria-label="Recommended length of time (in minutes) it takes to play through a gamespace launched from this workspace."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>
    <input id="durationMinutes-input" type="number" class="form-control" formControlName="durationMinutes">
    <small>
      Estimated time (minutes) to complete the lab. This helps set expectations for players.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center">
      Collaboration
      <span
        class="ml-2 text-muted"
        role="button"
        tabindex="0"
        data-toggle="tooltip"
        data-placement="right"
        title="Invite collaborators by sharing an invitation URL. Collaborators can help edit the workspace. Generating a new invitation invalidates the existing one."
        aria-label="Invite collaborators by sharing an invitation URL. Collaborators can help edit the workspace. Generating a new invitation invalidates the existing one."
      >
        <fa-icon [icon]="faInfoCircle"></fa-icon>
      </span>
    </label>

    <div *ngIf="!workspace.workers?.length">&mdash; none</div>

    <div *ngFor="let worker of workspace.workers">
      <app-confirm-button class="mr-2" btnClass="btn btn-outline-danger btn-sm" (confirm)="delist(worker)" aria-label="remove collaborator">
        <fa-icon [icon]="faTimes"></fa-icon>
        <span>Remove</span>
      </app-confirm-button>
      <span>{{worker.subjectName}}</span>
    </div>

    <div class="mt-2">
      <button class="btn btn-outline-secondary" (click)="enlistCode()">
        <fa-icon [icon]="copiedInvite ? faClipboardCheck : faUserCog"></fa-icon>
        <span>Generate invitation</span>
      </button>
    </div>
    <small>
      Share an invitation link to add collaborators. Generating a new link invalidates the previous one.
    </small>

  </div>

  <hr/>
  <app-error-div [errors]="errors"></app-error-div>
  <div class="text-center mb-4">

    <app-confirm-button btnClass="btn btn-outline-secondary btn-lg" (confirm)="clone()">
      <fa-icon [icon]="faCopy"></fa-icon>
      <span>Clone</span>
    </app-confirm-button>

    <span class="m-2"></span>

    <app-confirm-button btnClass="btn btn-outline-danger btn-lg" (confirm)="delete()">
      <fa-icon [icon]="faTrash"></fa-icon>
      <span>Delete</span>
    </app-confirm-button>

  </div>
</form>
