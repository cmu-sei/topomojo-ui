<!-- Copyright 2021 Carnegie Mellon University. -->
<!-- Released under a 3 Clause BSD-style license. See LICENSE.md in the project root. -->

<div>
  <div class="text-muted">
    Use this form to customize a VM template for your workspace: name and description, network connections, deployment
    options (replicas/variant), optional ISO attachments, and whether the console should be visible to players.
  </div>
</div>

<form #form="ngForm" [ngFormOptions]="{updateOn: 'blur'}" autocomplete="off">

  <!-- <input type="hidden" name="id" [ngModel]="template.id"> -->
  <input type="hidden" name="id" [ngModel]="template.id">
  <input type="hidden" name="iso" [ngModel]="template.iso">

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="name-input">
      Name
    </label>

    <input
      id="name-input"
      type="text"
      class="form-control"
      [(ngModel)]="template.name"
      name="name"
      #name="ngModel"
      required
      maxlength="64"
      (input)="nospace($event)"
    >
    <small [hidden]="name.valid || name.pristine" class="text-danger">Please enter a name for this template.</small>

    <small class="d-block text-muted">
      This name appears in the topology and is used to reference the VM. Keep it short, unique, and meaningful.
    </small>

    <small class="ml-2">
      <fa-icon [icon]="template.isLinked ? faLink : faUnlink"></fa-icon>
      <span>{{template.parentName}}</span>
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="description-input">
      Description
    </label>

    <textarea
      id="description-input"
      type="text"
      rows="5"
      class="form-control"
      [(ngModel)]="template.description"
      name="description"
      maxlength="255"
    ></textarea>

    <small class="text-muted">
      Include what this VM is for (role in the lab) and how to access it (e.g., username/password, service notes).
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="network-input">
      Networks
    </label>

    <input
      id="network-input"
      type="text"
      class="form-control"
      [(ngModel)]="template.networks"
      name="networks"
      maxlength="64"
    >

    <small class="text-muted">
      Enter one or more networks separated by spaces (e.g., <code>lan wan</code>). VMs on the same named network can communicate.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="guestinfo-input">
      Guest Settings
    </label>

    <textarea
      id="guestinfo-input"
      type="text"
      rows="5"
      class="form-control"
      placeholder="key=value"
      [(ngModel)]="template.guestinfo"
      name="guestinfo"
      maxlength="1024"
    ></textarea>

    <small class="text-muted">
      Provide values the VM can read at runtime (example: <code>var1=test</code>). Comment lines with <code>#</code>.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="replicas-input">
      Replicas
    </label>

    <input
      id="replicas-input"
      type="number"
      class="form-control"
      [(ngModel)]="template.replicas"
      name="replicas"
    >

    <small class="text-muted">
      Set to <code>1</code> for a single VM, <code>3</code> for three identical VMs, or <code>-1</code> for one per player.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="variant-input">
      Variant
    </label>

    <input
      id="variant-input"
      type="number"
      class="form-control"
      [(ngModel)]="template.variant"
      name="variant"
    >

    <small class="text-muted">
      Use <code>0</code> to deploy in all variants. Use <code>2</code> to deploy only when launching variant 2.
    </small>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="iso-input">
      ISO
    </label>

    <div class="input-group input-group-sm mb-1">
      <label id="iso-input" class="form-control" name="iso">
        {{(template.iso || "").split('/').pop()}}
      </label>
      <div class="input-group-append">
        <button class="btn btn-sm btn-outline-info" (click)="isoClear()">
          <fa-icon [icon]="faTimes"></fa-icon>
          <span>Remove</span>
        </button>
      </div>
    </div>

    <small class="text-muted d-block mb-2">
      Common use: attach an OS installer ISO for a blank disk template or mount utilities during setup.
    </small>

    <app-iso-selector [guid]="template.workspaceId" (added)="isoSelect($event)"></app-iso-selector>
  </div>

  <div class="form-group bg-light">
    <label class="mb-0 d-flex align-items-center" for="hidden-toggle">
      Console Access
    </label>

    <div class="form-control auto-h d-flex align-items-center" id="hidden-toggle">
      <label class="mb-0">Hidden</label>
      <label
        class="btn text-info"
        btnCheckbox
        [btnCheckboxTrue]="false"
        [btnCheckboxFalse]="true"
        [ngModelOptions]="{updateOn: 'change'}"
        [(ngModel)]="template.isHidden"
        name="isHidden"
        aria-label="toggle console visibility"
      >
        <fa-icon *ngIf="template.isHidden" [icon]="faToggleOff" size="lg"></fa-icon>
        <fa-icon *ngIf="!template.isHidden" [icon]="faToggleOn" size="lg"></fa-icon>
      </label>
      <label class="mb-0">Visible</label>
    </div>

    <small class="text-muted">
      Set to Hidden to prevent console access for players. Leave Visible for systems users must interact with.
    </small>
  </div>
</form>
