<!-- Copyright 2021 Carnegie Mellon University. -->
<!-- Released under a 3 Clause BSD-style license. See LICENSE.md in the project root. -->

<ng-container *ngIf="websocket | async as ws">
    <div *ngIf="!!user && ws.initialized && !ws.connected" class="banner bg-danger text-center">
        <small>
            <fa-icon [icon]="faExclamationTriangle"></fa-icon>
            <span>Attempting re-connection...</span>
        </small>
    </div>
</ng-container>

<nav class="navbar navbar-dark bg-primary">
    <a class="navbar-brand" [routerLink]="['/']">{{appname}}</a>

    <div>
        <a class="btn btn-outline-light btn-sm" [routerLink]="['/']">Home</a>
        <a class="btn btn-outline-light btn-sm ml-2" [routerLink]="['/about']">About</a>
        <button *ngIf="!!user && user.isAdmin" class="btn btn-outline-light btn-sm ml-2"
            [routerLink]="['/admin']">Admin</button>
        <button *ngIf="!!user && user.isObserver && !user.isAdmin" class="btn btn-outline-light btn-sm ml-2"
            [routerLink]="['/observe']">Observe</button>
        <button *ngIf="!!user" class="btn btn-outline-light btn-sm ml-2" (click)="logout()">Logout</button>
    </div>
</nav>

<ng-container *ngIf="!!user">

    <div #sidebarContainer>

        <section
                class="sidebar sidebar-body bg-light"
                [class.sidebar-out]="open"
                [class.sidebar-in]="!open">

            <div [hidden]="open"
                class="text-secondary m-3"
                (click)="toggleSidebar()">
            <fa-icon [icon]="faBars" size="lg"></fa-icon>
            </div>

            <app-workspace-browser [hidden]="!open"></app-workspace-browser>
        </section>

        <div class="sidebar sidebar-footer bg-light align-items-center"
     tabindex="0"
     (keyup)="keyclick($event)"
     [class.sidebar-out]="open"
     [class.sidebar-in]="!open"
     aria-label="toggle pin and close for left panel">

  <div *ngIf="open"
       class="sidebar-footer-inner d-flex align-items-center w-100">

    <img
      class="crucible-logo"
      src="assets/img/crucible-logo-light.png"
      alt="Part of the Crucible Framework"
    />

    <div class="ml-auto d-flex align-items-center">
      <button class="btn btn-link p-0 mr-3 text-secondary"
              type="button"
              (click)="pin()"
              aria-label="Toggle pin sidebar">
        <fa-icon [icon]="faThumbtack"
                 [class.untack]="!pinned"
                 size="lg"></fa-icon>
      </button>

      <button class="btn btn-link p-0 text-secondary"
              type="button"
              (click)="closeSidebar()"
              aria-label="Close sidebar">
        <fa-icon [icon]="faClose" size="lg"></fa-icon>
      </button>
    </div>

  </div>
</div>
    </div>
</ng-container>

<main
  [class.sidebar-offset-out]="user && pinned && open"
  [class.sidebar-offset-in]="user && (!pinned || !open)">
    <div class="tm-page-shell">
        <div class="container-fluid tm-page-card">
            <router-outlet></router-outlet>
        </div>
    </div>
</main>

<footer class="bg-primary"></footer>
